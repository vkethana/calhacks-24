<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading App</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Trading Application</h1>

    <div>
        <h2>Input Trading Information</h2>
        <label for="trading_date">Trading Date:</label>
        <input type="date" id="trading_date" required>
        <label for="evaluation_date">Evaluation Date:</label>
        <input type="date" id="evaluation_date" required>
        <button id="submit">Get PnL</button>
    </div>

    <h2>Trades Generated by LLM:</h2>
    <div id="trades-list">
        <p>No trades available.</p>
    </div>

    <h2>Headlines:</h2>
    <div id="headlines">
        <p>No headlines available.</p>
    </div>

    <h2>Total PnL:</h2>
    <div id="pnl-result">
        <p>No PnL calculated yet.</p>
    </div>

    <script>
        $(document).ready(function() {
            $('#submit').click(function() {
                const tradingDate = $('#trading_date').val();
                const evaluationDate = $('#evaluation_date').val();

                // Clear previous results
                $('#trades-list').empty();
                $('#headlines').empty();
                $('#pnl-result').empty();

                // Make API call to get trades and PnL
                $.ajax({
                    url: '/api/get_trades_and_pnl',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        trading_date: tradingDate,
                        evaluation_date: evaluationDate
                    }),
                    success: function(response) {
                        // Display trades
                        const trades = response.trades;
                        if (trades.length > 0) {
                            trades.forEach(trade => {
                                $('#trades-list').append(`<p>${trade.timestamp} - ${trade.action} ${trade.volume} shares of ${trade.ticker}</p>`);
                            });
                        } else {
                            $('#trades-list').append('<p>No trades generated.</p>');
                        }

                        // Display headlines
                        const headlines = response.headlines;
                        if (headlines.length > 0) {
                            headlines.forEach(headline => {
                                $('#headlines').append(`<p>${headline}</p>`);
                            });
                        } else {
                            $('#headlines').append('<p>No headlines found.</p>');
                        }

                        // Display PnL
                        const pnl = response.result;
                        $('#pnl-result').append(`<p>Total PnL: ${pnl.toFixed(2)}</p>`);
                    },
                    error: function(xhr) {
                        // Handle error
                        const errorMsg = xhr.responseJSON ? xhr.responseJSON.error : 'An error occurred.';
                        alert(`Error: ${errorMsg}`);
                    }
                });
            });
        });
    </script>
</body>
</html>
